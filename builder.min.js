var builder=function(t){"use strict";const e={scale:1,offset:{x:0,y:0},isSelecting:!1,selectionStart:{x:0,y:0},selectionEnd:{x:0,y:0},isJoining:!1,joinStart:{x:0,y:0},joinEnd:{x:0,y:0},joinStartId:null,joinEndId:null};function i(t){e.offset=t}function n(t){e.isSelecting=t}function o(t){e.selectionEnd=t}function s(t){e.isJoining=t}function d(t){e.joinEnd=t}function l(t){e.joinStartId=t}function a(t){e.joinEndId=t}let h={nodes:[{id:1,position:{x:100,y:100},size:{width:80,height:40},selected:!1,type:"input",name:"Input",outputPins:[{id:85,value:2,type:"number"}]},{id:2,position:{x:200,y:200},size:{width:80,height:40},selected:!1,type:"input",name:"Input",outputPins:[{id:86,value:10,type:"number"}]},{id:3,position:{x:300,y:300},size:{width:80,height:40},selected:!1,type:"function",name:"Multiply",functionId:"sd78f979f8ds",inputPins:[{id:87,type:"number"},{id:88,type:"number"}],outputPins:[{id:89,value:10,type:"number"},{id:810,value:10,type:"error"}],solved:!0},{id:5,position:{x:400,y:400},size:{width:80,height:40},selected:!1,type:"output",name:"Output",inputPins:[{id:811,type:"error"}]},{id:4,position:{x:400,y:400},size:{width:80,height:40},selected:!1,type:"error",name:"Error",inputPins:[{id:812,type:"number"}]}],edges:[{start:85,end:87,selected:!0},{start:86,end:88,selected:!1},{start:89,end:811,selected:!1},{start:810,end:812,selected:!1}],solved:!0},c=[JSON.stringify(h)],r=0;function f(){const t=JSON.stringify(h);c[r]!==t&&(r<c.length-1&&(c=c.slice(0,r+1)),c.push(t),c.length>50?c.shift():r++)}function u(){r<c.length-1&&(r++,h=JSON.parse(c[r]))}const y=10,p=5;function x(t,e,i){var n,o;const s=[],d=y*e,l=d/2,a=p*e,h=null!==(n=t.outputPins)&&void 0!==n?n:[];let c=t.position.x*e+i.x+(t.size.width*e-(h.length*d+(h.length-1)*a))/2+l;h.forEach((n=>{s.push({id:n.id,type:"output",position:{x:c,y:t.position.y*e+i.y+t.size.height*e+l+5*e}}),c+=d+a}));const r=null!==(o=t.inputPins)&&void 0!==o?o:[];let f=t.position.x*e+i.x+(t.size.width*e-(r.length*d+(r.length-1)*a))/2+l;return r.forEach(((n,o)=>{s.push({id:n.id,type:"input",position:{x:f,y:t.position.y*e+i.y-l-5*e}}),f+=d+a})),s}function g(t,i,n,o,s){const{scale:d,offset:l}=e;t.strokeStyle=o,t.lineWidth=s;const a=n*d,h=l.x%a-a,c=l.y%a-a,r=i.width,f=i.height;for(let e=h;e<r;e+=a)t.beginPath(),t.moveTo(e,0),t.lineTo(e,f),t.stroke();for(let e=c;e<f;e+=a)t.beginPath(),t.moveTo(0,e),t.lineTo(r,e),t.stroke()}function w(t,i,n){const{isSelecting:o,isJoining:s,joinStart:d,joinEnd:l}=e,a=t.getContext("2d"),c=i.getContext("2d"),r=n.getContext("2d");if(!a||!c||!r)throw new Error("Canvas not supported");a.clearRect(0,0,t.width,t.height),c.clearRect(0,0,i.width,i.height),function(t,e){t.fillStyle="#262626",t.fillRect(0,0,e.width,e.height),g(t,e,20,"#353535",1),g(t,e,200,"#161616",2)}(r,n),function(t){const{scale:i,offset:n}=e;h.nodes.forEach((e=>{const o=4*i,{x:s,y:d,width:l,height:a}={x:e.position.x*i+n.x,y:e.position.y*i+n.y,width:e.size.width*i,height:e.size.height*i};t.shadowColor="rgba(0, 0, 0, 0.3)",t.shadowBlur=8,t.shadowOffsetX=4,t.shadowOffsetY=4,t.beginPath(),t.moveTo(s+o,d),t.lineTo(s+l-o,d),t.quadraticCurveTo(s+l,d,s+l,d+o),t.lineTo(s+l,d+a-o),t.quadraticCurveTo(s+l,d+a,s+l-o,d+a),t.lineTo(s+o,d+a),t.quadraticCurveTo(s,d+a,s,d+a-o),t.lineTo(s,d+o),t.quadraticCurveTo(s,d,s+o,d),t.closePath(),t.fillStyle="rgba(133, 133, 133, 0.7)",t.fill(),t.fillStyle="rgba(255, 255, 255, 0.5)",t.font=14*i+"px Arial";const h=s+l+10,c=d+a/2+5;t.fillText(e.name,h,c),e.selected&&(t.strokeStyle="gold",t.lineWidth=2.5*i,t.stroke()),x(e,i,n).forEach((({id:e,type:n,position:o})=>{const s=y/2*i;t.beginPath(),t.arc(o.x,o.y,s,0,2*Math.PI),t.fillStyle="grey",t.shadowColor="rgba(0, 0, 0, 0.5)",t.shadowBlur=5,t.shadowOffsetX=2,t.shadowOffsetY=2,t.fill(),t.shadowColor="transparent",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0,t.beginPath();const d=.4*s;t.arc(o.x,o.y,d,0,2*Math.PI),t.fillStyle="rgba(0, 0, 0, 0.7)",t.fill()})),t.shadowColor="transparent",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}))}(c),function(t){const{scale:i,offset:n}=e;t.lineWidth=2.5*i,t.shadowColor="rgba(0, 0, 0, 0.5)",t.shadowBlur=10*i,t.shadowOffsetX=5*i,t.shadowOffsetY=5*i,t.lineCap="round",h.edges.forEach((e=>{const o=h.nodes.find((t=>{var i;return null===(i=t.outputPins)||void 0===i?void 0:i.some((t=>t.id===e.start))})),s=h.nodes.find((t=>{var i;return null===(i=t.inputPins)||void 0===i?void 0:i.some((t=>t.id===e.end))}));if(!(o&&s&&o.outputPins&&s.inputPins))return;const d=o.outputPins.find((t=>t.id===e.start)),l=s.inputPins.find((t=>t.id===e.end));if(!d||!l)return;"error"===d.type?t.strokeStyle=e.selected?"gold":"#D04545":t.strokeStyle=e.selected?"gold":"#4181DC";const a=y*i,c=a/2,r=p*i,f=o.outputPins.indexOf(d),u=s.inputPins.indexOf(l),x=o.position.x*i+n.x+(o.size.width*i-(o.outputPins.length*a+(o.outputPins.length-1)*r))/2+f*(a+r)+c,g=o.position.y*i+n.y+o.size.height*i+c+5*i,w=s.position.x*i+n.x+(s.size.width*i-(s.inputPins.length*a+(s.inputPins.length-1)*r))/2+u*(a+r)+c,m=s.position.y*i+n.y-c-5*i,v=w-x,E=m-g,M=Math.sqrt(v*v+E*E)/3,b=x+v/3,P=g+(E<0?-1:1)*M,C=w-v/3,S=m-(E<0?-1:1)*M;t.beginPath(),t.moveTo(x,g),t.bezierCurveTo(b,P,C,S,w,m),t.stroke()})),t.shadowColor="transparent",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0,t.lineCap="butt"}(c),o&&function(t){const{scale:i,offset:n,selectionEnd:o,selectionStart:s}=e,d=Math.min(s.x,o.x)*i+n.x,l=Math.min(s.y,o.y)*i+n.y,a=Math.abs(o.x-s.x)*i,h=Math.abs(o.y-s.y)*i;t.save(),t.setLineDash([5,3]),t.strokeStyle="white",t.lineWidth=1,t.beginPath(),t.rect(d,l,a,h),t.stroke(),t.restore()}(a),s&&d&&l&&function(t,e,i,n,o){const s=e.x*n+o.x,d=e.y*n+o.y,l=i.x*n+o.x,a=i.y*n+o.y,h=l-s,c=a-d,r=Math.sqrt(h*h+c*c)/3,f=s+h/3,u=d+(c<0?-1:1)*r,y=l-h/3,p=a-(c<0?-1:1)*r;t.beginPath(),t.moveTo(s,d),t.bezierCurveTo(f,u,y,p,l,a),t.strokeStyle="gold",t.stroke()}(c,d,l,e.scale,e.offset)}let m=null;const v=document.getElementById("topCanvas"),E=document.getElementById("mainCanvas"),M=document.getElementById("backgroundCanvas");function b(){null!==m&&cancelAnimationFrame(m);const t=()=>{w(v,E,M),m=requestAnimationFrame(t)};t()}let P={x:0,y:0},C=!1,S={x:0,y:0};function k(t,e,i){const n=Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2);if(0===n)return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));let o=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;o=Math.max(0,Math.min(1,o));const s=e.x+o*(i.x-e.x),d=e.y+o*(i.y-e.y);return Math.sqrt(Math.pow(t.x-s,2)+Math.pow(t.y-d,2))}function T(t,i){const{scale:n,offset:o}=e;let s=!1;const d={x:t*n+o.x,y:i*n+o.y};return h.nodes.forEach((t=>t.selected=!1)),h.edges.forEach((t=>t.selected=!1)),h.edges.forEach((t=>{const e=h.nodes.flatMap((t=>x(t,n,o))).find((e=>e.id===t.start)),i=h.nodes.flatMap((t=>x(t,n,o))).find((e=>e.id===t.end));if(!e||!i)return;const l=i.position.x-e.position.x,a=i.position.y-e.position.y,c=Math.sqrt(l*l+a*a)/3,r={x:e.position.x+l/3,y:e.position.y+(a<0?-1:1)*c},f={x:i.position.x-l/3,y:i.position.y-(a<0?-1:1)*c},u=function(t,e,i,n,o){const s=[];for(let d=0;d<=o;d++){const l=d/o,a=Math.pow(1-l,3)*t.x+3*Math.pow(1-l,2)*l*e.x+3*(1-l)*Math.pow(l,2)*i.x+Math.pow(l,3)*n.x,h=Math.pow(1-l,3)*t.y+3*Math.pow(1-l,2)*l*e.y+3*(1-l)*Math.pow(l,2)*i.y+Math.pow(l,3)*n.y;s.push({x:a,y:h})}return s}(e.position,r,f,i.position,20);for(let e=0;e<u.length-1;e++){if(k(d,u[e],u[e+1])<7*n){s=!0,t.selected=!t.selected;break}}})),s}function z(t,i){const{scale:n,offset:o}=e;let s=!1;return h.nodes.forEach((e=>{x(e,n,o).forEach((e=>{const d=t*n+o.x,l=i*n+o.y,a=d-e.position.x,c=l-e.position.y;if(Math.sqrt(a*a+c*c)<y*n){h.edges.some((t=>t.start===e.id||t.end===e.id))||(s={position:{x:(e.position.x-o.x)/n,y:(e.position.y-o.y)/n},id:e.id},h.nodes.forEach((t=>t.selected=!1)),h.edges.forEach((t=>t.selected=!1)),"output"===e.type?h.edges.filter((t=>t.start===e.id)).forEach((t=>t.selected=!0)):h.edges.filter((t=>t.end===e.id)).forEach((t=>t.selected=!0)))}}))})),s}v.addEventListener("mousedown",(function(t){const{scale:i,offset:a}=e;t.preventDefault(),S.x=t.clientX,S.y=t.clientY,C=!1;const c=(t.clientX-v.offsetLeft-a.x)/i,r=(t.clientY-v.offsetTop-a.y)/i;let f=!1;h.nodes.forEach((e=>{c>=e.position.x&&c<=e.position.x+e.size.width&&r>=e.position.y&&r<=e.position.y+e.size.height&&(f=!0,h.edges.forEach((t=>t.selected=!1)),t.shiftKey?e.selected=!e.selected:e.selected||(h.nodes.forEach((t=>t.selected=!1)),e.selected=!0))}));let u=z(c,r);if(!f&&!u){if(z(c,r))return void b();if(T(c,r))return void b()}var y,p;0!==t.button||t.shiftKey||f||u||(h.nodes.forEach((t=>t.selected=!1)),h.edges.forEach((t=>t.selected=!1)),n(!0),y={x:c,y:r},e.selectionStart=y,o({x:c,y:r})),0!==t.button||t.shiftKey||f||!u||(s(!0),p=u.position,e.joinStart=p,l(u.id),d({x:c,y:r})),(2===t.button||0===t.button&&t.ctrlKey)&&(P.x=t.clientX-a.x,P.y=t.clientY-a.y,C=!0),b()})),v.addEventListener("mousemove",I((function(t){const{scale:n,offset:s,isSelecting:l,isJoining:a}=e;if(1===t.buttons&&!C){const e=(t.clientX-S.x)/n,i=(t.clientY-S.y)/n;(Math.abs(e)>5||Math.abs(i)>5)&&(h.nodes.forEach((t=>{t.selected&&(t.position.x+=e,t.position.y+=i)})),S.x=t.clientX,S.y=t.clientY,b())}if(2===t.buttons||1===t.buttons&&t.ctrlKey){i({x:t.clientX-P.x,y:t.clientY-P.y}),b()}if(l){o({x:(t.clientX-v.offsetLeft-s.x)/n,y:(t.clientY-v.offsetTop-s.y)/n}),b()}if(a){d({x:(t.clientX-v.offsetLeft-s.x)/n,y:(t.clientY-v.offsetTop-s.y)/n}),b()}}),16.67)),v.addEventListener("mouseup",(function(t){const{scale:i,offset:o,isSelecting:d,selectionEnd:c,selectionStart:r,isJoining:u,joinEnd:y}=e;if(C=!1,d){const t={x:r.x*i+o.x,y:r.y*i+o.y},e={x:c.x*i+o.x,y:c.y*i+o.y},s={left:Math.min(t.x,e.x),right:Math.max(t.x,e.x),top:Math.min(t.y,e.y),bottom:Math.max(t.y,e.y)};h.nodes.forEach((t=>{const e=t.position.x*i+o.x,n=t.position.y*i+o.y,d=t.size.width*i,l=t.size.height*i;e+d>s.left&&e<s.right&&n+l>s.top&&n<s.bottom&&(t.selected=!0)})),n(!1)}if(u){const t=z(y.x,y.y);t?a(t.id):(l(null),a(null)),t&&null!==e.joinStartId&&null!==e.joinEndId&&e.joinStartId!==e.joinEndId&&h.edges.push({start:e.joinStartId,end:e.joinEndId,selected:!0}),s(!1)}f(),b()})),v.addEventListener("contextmenu",(function(t){t.preventDefault()})),document.addEventListener("keydown",(function(t){if("Delete"===t.key||"Backspace"===t.key){const t=document.activeElement,e=null==t?void 0:t.tagName.toLowerCase();if("input"!==e&&"textarea"!==e){let t=!1;h.nodes.some((t=>t.selected))&&(h.nodes=h.nodes.filter((t=>!t.selected)),t=!0),t||(h.edges=h.edges.filter((t=>!t.selected))),f(),b()}}"z"!==t.key&&"Z"!==t.key||!t.ctrlKey&&!t.metaKey?"y"!==t.key&&"Y"!==t.key||!t.ctrlKey&&!t.metaKey||(t.preventDefault(),u(),b()):(t.preventDefault(),t.shiftKey?u():r>0&&(r--,h=JSON.parse(c[r])),b())}));const O=I((function(t){const{scale:n,offset:o}=e;t.preventDefault();const s=t.clientX-v.getBoundingClientRect().left,d=t.clientY-v.getBoundingClientRect().top,l=-1*t.deltaY/50,a=Math.exp(.05*l),h=Math.min(Math.max(n*a,.6),2);i({x:(o.x-s)*(h/n)+s,y:(o.y-d)*(h/n)+d}),function(t){e.scale=t}(h),b()}),16.67);function j(){var t,e,i;const n=window.devicePixelRatio||1,o=v.getBoundingClientRect(),s=E.getBoundingClientRect(),d=M.getBoundingClientRect();v.width=o.width*n,v.height=o.height*n,E.width=s.width*n,E.height=s.height*n,M.width=d.width*n,M.height=d.height*n,v&&E&&M&&(null===(t=v.getContext("2d"))||void 0===t||t.scale(n,n),null===(e=E.getContext("2d"))||void 0===e||e.scale(n,n),null===(i=M.getContext("2d"))||void 0===i||i.scale(n,n),v.width=o.width*n,v.height=o.height*n,v.style.width=`${o.width}px`,v.style.height=`${o.height}px`,E.width=s.width*n,E.height=s.height*n,E.style.width=`${s.width}px`,E.style.height=`${s.height}px`,M.width=d.width*n,M.height=d.height*n,M.style.width=`${d.width}px`,M.style.height=`${d.height}px`,b())}function I(t,e){let i=!1;return(...n)=>{i||(t(...n),i=!0,setTimeout((()=>{i=!1}),e))}}return v.addEventListener("wheel",O),document.addEventListener("dataChanged",(()=>{b()})),window.addEventListener("resize",j),j(),b(),t.drawNow=b,t.stopDrawing=function(){null!==m&&(cancelAnimationFrame(m),m=null)},Object.defineProperty(t,"__esModule",{value:!0}),t}({});
//# sourceMappingURL=builder.min.js.map
