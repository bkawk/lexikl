var builder=function(t){"use strict";const e={scale:1,offset:{x:0,y:0},isSelecting:!1,selectionStart:{x:0,y:0},selectionEnd:{x:0,y:0},isJoining:!1,joinStart:{x:0,y:0},joinEnd:{x:0,y:0},joinStartId:null,joinEndId:null};function n(t){e.offset=t}function o(t){e.isSelecting=t}function i(t){e.selectionEnd=t}function s(t){e.isJoining=t}function d(t){e.joinEnd=t}function a(t){e.joinStartId=t}function l(t){e.joinEndId=t}let r={nodes:[{id:1,position:{x:100,y:100},size:{width:80,height:40},selected:!1,type:"input",name:"Input",outputPins:[{id:85,value:2,type:"number"}]},{id:2,position:{x:200,y:200},size:{width:80,height:40},selected:!1,type:"input",name:"Input",outputPins:[{id:86,value:10,type:"number"}]},{id:3,position:{x:300,y:300},size:{width:80,height:40},selected:!1,type:"function",name:"Multiply",functionId:"sd78f979f8ds",inputPins:[{id:87,type:"number"},{id:88,type:"number"}],outputPins:[{id:89,value:10,type:"number"},{id:810,value:10,type:"error"}],solved:!0},{id:5,position:{x:400,y:400},size:{width:80,height:40},selected:!1,type:"output",name:"Output",inputPins:[{id:811,type:"error"}]},{id:4,position:{x:400,y:400},size:{width:80,height:40},selected:!1,type:"error",name:"Error",inputPins:[{id:812,type:"number"}]}],edges:[{start:85,end:87,selected:!0},{start:86,end:88,selected:!1},{start:89,end:811,selected:!1},{start:810,end:812,selected:!1}],solved:!0},c=[JSON.stringify(r)],h=0;function f(){const t=JSON.stringify(r);c[h]!==t&&(h<c.length-1&&(c=c.slice(0,h+1)),c.push(t),c.length>50?c.shift():h++,console.log("captureState: New state captured, currentIndex:",h))}function u(){h<c.length-1?(h++,r=JSON.parse(c[h]),console.log("redo: State advanced to currentIndex:",h,"data:",r)):console.log("redo: No more states to advance to")}const y=10,p=5;function x(t,e,n){var o,i;const s=[],d=y*e,a=d/2,l=p*e,r=null!==(o=t.outputPins)&&void 0!==o?o:[];let c=t.position.x*e+n.x+(t.size.width*e-(r.length*d+(r.length-1)*l))/2+a;r.forEach((o=>{s.push({id:o.id,type:"output",position:{x:c,y:t.position.y*e+n.y+t.size.height*e+a+5*e}}),c+=d+l}));const h=null!==(i=t.inputPins)&&void 0!==i?i:[];let f=t.position.x*e+n.x+(t.size.width*e-(h.length*d+(h.length-1)*l))/2+a;return h.forEach(((o,i)=>{s.push({id:o.id,type:"input",position:{x:f,y:t.position.y*e+n.y-a-5*e}}),f+=d+l})),s}function g(t,n,o,i,s){const{scale:d,offset:a}=e;t.strokeStyle=i,t.lineWidth=s;const l=o*d,r=a.x%l-l,c=a.y%l-l,h=n.width,f=n.height;for(let e=r;e<h;e+=l)t.beginPath(),t.moveTo(e,0),t.lineTo(e,f),t.stroke();for(let e=c;e<f;e+=l)t.beginPath(),t.moveTo(0,e),t.lineTo(h,e),t.stroke()}function w(t,n,o){const{isSelecting:i,isJoining:s,joinStart:d,joinEnd:a}=e,l=t.getContext("2d"),c=n.getContext("2d"),h=o.getContext("2d");if(!l||!c||!h)throw new Error("Canvas not supported");l.clearRect(0,0,t.width,t.height),c.clearRect(0,0,n.width,n.height),function(t,e){t.fillStyle="#262626",t.fillRect(0,0,e.width,e.height),g(t,e,20,"#353535",1),g(t,e,200,"#161616",2)}(h,o),function(t){const{scale:n,offset:o}=e;r.nodes.forEach((e=>{const i=4*n,{x:s,y:d,width:a,height:l}={x:e.position.x*n+o.x,y:e.position.y*n+o.y,width:e.size.width*n,height:e.size.height*n};t.shadowColor="rgba(0, 0, 0, 0.3)",t.shadowBlur=8,t.shadowOffsetX=4,t.shadowOffsetY=4,t.beginPath(),t.moveTo(s+i,d),t.lineTo(s+a-i,d),t.quadraticCurveTo(s+a,d,s+a,d+i),t.lineTo(s+a,d+l-i),t.quadraticCurveTo(s+a,d+l,s+a-i,d+l),t.lineTo(s+i,d+l),t.quadraticCurveTo(s,d+l,s,d+l-i),t.lineTo(s,d+i),t.quadraticCurveTo(s,d,s+i,d),t.closePath(),t.fillStyle="rgba(133, 133, 133, 0.7)",t.fill(),t.fillStyle="rgba(255, 255, 255, 0.5)",t.font=14*n+"px Arial";const r=s+a+10,c=d+l/2+5;t.fillText(e.name,r,c),e.selected&&(t.strokeStyle="gold",t.lineWidth=2.5*n,t.stroke()),x(e,n,o).forEach((({id:e,type:o,position:i})=>{const s=y/2*n;t.beginPath(),t.arc(i.x,i.y,s,0,2*Math.PI),t.fillStyle="grey",t.shadowColor="rgba(0, 0, 0, 0.5)",t.shadowBlur=5,t.shadowOffsetX=2,t.shadowOffsetY=2,t.fill(),t.shadowColor="transparent",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0,t.beginPath();const d=.4*s;t.arc(i.x,i.y,d,0,2*Math.PI),t.fillStyle="rgba(0, 0, 0, 0.7)",t.fill()})),t.shadowColor="transparent",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}))}(c),function(t){const{scale:n,offset:o}=e;t.lineWidth=2.5*n,t.shadowColor="rgba(0, 0, 0, 0.5)",t.shadowBlur=10*n,t.shadowOffsetX=5*n,t.shadowOffsetY=5*n,t.lineCap="round",r.edges.forEach((e=>{const i=r.nodes.find((t=>{var n;return null===(n=t.outputPins)||void 0===n?void 0:n.some((t=>t.id===e.start))})),s=r.nodes.find((t=>{var n;return null===(n=t.inputPins)||void 0===n?void 0:n.some((t=>t.id===e.end))}));if(!(i&&s&&i.outputPins&&s.inputPins))return;const d=i.outputPins.find((t=>t.id===e.start)),a=s.inputPins.find((t=>t.id===e.end));if(!d||!a)return;"error"===d.type?t.strokeStyle=e.selected?"gold":"#D04545":t.strokeStyle=e.selected?"gold":"#4181DC";const l=y*n,c=l/2,h=p*n,f=i.outputPins.indexOf(d),u=s.inputPins.indexOf(a),x=i.position.x*n+o.x+(i.size.width*n-(i.outputPins.length*l+(i.outputPins.length-1)*h))/2+f*(l+h)+c,g=i.position.y*n+o.y+i.size.height*n+c+5*n,w=s.position.x*n+o.x+(s.size.width*n-(s.inputPins.length*l+(s.inputPins.length-1)*h))/2+u*(l+h)+c,v=s.position.y*n+o.y-c-5*n,m=w-x,E=v-g,M=Math.sqrt(m*m+E*E)/3,b=x+m/3,S=g+(E<0?-1:1)*M,P=w-m/3,C=v-(E<0?-1:1)*M;t.beginPath(),t.moveTo(x,g),t.bezierCurveTo(b,S,P,C,w,v),t.stroke()})),t.shadowColor="transparent",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0,t.lineCap="butt"}(c),i&&function(t){const{scale:n,offset:o,selectionEnd:i,selectionStart:s}=e,d=Math.min(s.x,i.x)*n+o.x,a=Math.min(s.y,i.y)*n+o.y,l=Math.abs(i.x-s.x)*n,r=Math.abs(i.y-s.y)*n;t.save(),t.setLineDash([5,3]),t.strokeStyle="white",t.lineWidth=1,t.beginPath(),t.rect(d,a,l,r),t.stroke(),t.restore()}(l),s&&d&&a&&function(t,e,n,o,i){const s=e.x*o+i.x,d=e.y*o+i.y,a=n.x*o+i.x,l=n.y*o+i.y,r=a-s,c=l-d,h=Math.sqrt(r*r+c*c)/3,f=s+r/3,u=d+(c<0?-1:1)*h,y=a-r/3,p=l-(c<0?-1:1)*h;t.beginPath(),t.moveTo(s,d),t.bezierCurveTo(f,u,y,p,a,l),t.strokeStyle="gold",t.stroke()}(c,d,a,e.scale,e.offset)}const v=document.getElementById("topCanvas"),m=document.getElementById("mainCanvas"),E=document.getElementById("backgroundCanvas");function M(){w(v,m,E)}let b={x:0,y:0},S=!1,P={x:0,y:0};function C(t,e,n){const o=Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2);if(0===o)return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));let i=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/o;i=Math.max(0,Math.min(1,i));const s=e.x+i*(n.x-e.x),d=e.y+i*(n.y-e.y);return Math.sqrt(Math.pow(t.x-s,2)+Math.pow(t.y-d,2))}function k(t,n){const{scale:o,offset:i}=e;let s=!1;const d={x:t*o+i.x,y:n*o+i.y};return r.nodes.forEach((t=>t.selected=!1)),r.edges.forEach((t=>t.selected=!1)),r.edges.forEach((t=>{const e=r.nodes.flatMap((t=>x(t,o,i))).find((e=>e.id===t.start)),n=r.nodes.flatMap((t=>x(t,o,i))).find((e=>e.id===t.end));if(!e||!n)return;const a=n.position.x-e.position.x,l=n.position.y-e.position.y,c=Math.sqrt(a*a+l*l)/3,h={x:e.position.x+a/3,y:e.position.y+(l<0?-1:1)*c},f={x:n.position.x-a/3,y:n.position.y-(l<0?-1:1)*c},u=function(t,e,n,o,i){const s=[];for(let d=0;d<=i;d++){const a=d/i,l=Math.pow(1-a,3)*t.x+3*Math.pow(1-a,2)*a*e.x+3*(1-a)*Math.pow(a,2)*n.x+Math.pow(a,3)*o.x,r=Math.pow(1-a,3)*t.y+3*Math.pow(1-a,2)*a*e.y+3*(1-a)*Math.pow(a,2)*n.y+Math.pow(a,3)*o.y;s.push({x:l,y:r})}return s}(e.position,h,f,n.position,20);for(let e=0;e<u.length-1;e++){if(C(d,u[e],u[e+1])<15/o){s=!0,t.selected=!t.selected;break}}})),s}function z(t,n){const{scale:o,offset:i}=e;let s=!1;return r.nodes.forEach((e=>{x(e,o,i).forEach((e=>{const d=t*o+i.x,a=n*o+i.y,l=d-e.position.x,c=a-e.position.y;if(Math.sqrt(l*l+c*c)<y*o){r.edges.some((t=>t.start===e.id||t.end===e.id))||(s={position:{x:(e.position.x-i.x)/o,y:(e.position.y-i.y)/o},id:e.id},r.nodes.forEach((t=>t.selected=!1)),r.edges.forEach((t=>t.selected=!1)),"output"===e.type?r.edges.filter((t=>t.start===e.id)).forEach((t=>t.selected=!0)):r.edges.filter((t=>t.end===e.id)).forEach((t=>t.selected=!0)))}}))})),s}function I(){v.width=window.innerWidth,v.height=window.innerHeight,m.width=window.innerWidth,m.height=window.innerHeight,E.width=window.innerWidth,E.height=window.innerHeight,M()}return v.addEventListener("mousedown",(function(t){const{scale:n,offset:l}=e;t.preventDefault(),P.x=t.clientX,P.y=t.clientY,S=!1;const c=(t.clientX-v.offsetLeft-l.x)/n,h=(t.clientY-v.offsetTop-l.y)/n;let f=!1;r.nodes.forEach((e=>{c>=e.position.x&&c<=e.position.x+e.size.width&&h>=e.position.y&&h<=e.position.y+e.size.height&&(f=!0,r.edges.forEach((t=>t.selected=!1)),t.shiftKey?e.selected=!e.selected:e.selected||(r.nodes.forEach((t=>t.selected=!1)),e.selected=!0))}));let u=z(c,h);if(!f&&!u){if(z(c,h))return void M();if(k(c,h))return void M()}var y,p;0!==t.button||t.shiftKey||f||u||(r.nodes.forEach((t=>t.selected=!1)),r.edges.forEach((t=>t.selected=!1)),o(!0),y={x:c,y:h},e.selectionStart=y,i({x:c,y:h})),0!==t.button||t.shiftKey||f||!u||(s(!0),p=u.position,e.joinStart=p,a(u.id),d({x:c,y:h})),(2===t.button||0===t.button&&t.ctrlKey)&&(b.x=t.clientX-l.x,b.y=t.clientY-l.y,S=!0),M()})),v.addEventListener("mousemove",(function(t){const{scale:o,offset:s,isSelecting:a,isJoining:l}=e;if(1===t.buttons&&!S){const e=(t.clientX-P.x)/o,n=(t.clientY-P.y)/o;(Math.abs(e)>5||Math.abs(n)>5)&&(r.nodes.forEach((t=>{t.selected&&(t.position.x+=e,t.position.y+=n)})),P.x=t.clientX,P.y=t.clientY,M())}if(2===t.buttons||1===t.buttons&&t.ctrlKey){n({x:t.clientX-b.x,y:t.clientY-b.y}),M()}if(a){i({x:(t.clientX-v.offsetLeft-s.x)/o,y:(t.clientY-v.offsetTop-s.y)/o}),M()}if(l){d({x:(t.clientX-v.offsetLeft-s.x)/o,y:(t.clientY-v.offsetTop-s.y)/o}),M()}})),v.addEventListener("mouseup",(function(t){const{scale:n,offset:i,isSelecting:d,selectionEnd:c,selectionStart:h,isJoining:u,joinEnd:y}=e;if(S=!1,d){const t={x:h.x*n+i.x,y:h.y*n+i.y},e={x:c.x*n+i.x,y:c.y*n+i.y},s={left:Math.min(t.x,e.x),right:Math.max(t.x,e.x),top:Math.min(t.y,e.y),bottom:Math.max(t.y,e.y)};r.nodes.forEach((t=>{const e=t.position.x*n+i.x,o=t.position.y*n+i.y,d=t.size.width*n,a=t.size.height*n;e+d>s.left&&e<s.right&&o+a>s.top&&o<s.bottom&&(t.selected=!0)})),o(!1)}if(u){const t=z(y.x,y.y);t?l(t.id):(a(null),l(null)),t&&null!==e.joinStartId&&null!==e.joinEndId&&e.joinStartId!==e.joinEndId&&r.edges.push({start:e.joinStartId,end:e.joinEndId,selected:!0}),s(!1)}f(),M()})),v.addEventListener("contextmenu",(function(t){t.preventDefault()})),document.addEventListener("keydown",(function(t){if("Delete"===t.key||"Backspace"===t.key){const t=document.activeElement,e=null==t?void 0:t.tagName.toLowerCase();if("input"!==e&&"textarea"!==e){let t=!1;r.nodes.some((t=>t.selected))&&(r.nodes=r.nodes.filter((t=>!t.selected)),t=!0),t||(r.edges=r.edges.filter((t=>!t.selected))),f(),M()}}"z"!==t.key&&"Z"!==t.key||!t.ctrlKey&&!t.metaKey?"y"!==t.key&&"Y"!==t.key||!t.ctrlKey&&!t.metaKey||(t.preventDefault(),u(),M()):(t.preventDefault(),t.shiftKey?u():h>0?(h--,r=JSON.parse(c[h]),console.log("undo: State reverted to currentIndex:",h,"data:",r)):console.log("undo: No more states to revert to"),M())})),v.addEventListener("wheel",(function(t){const{scale:o,offset:i}=e;t.preventDefault();const s=t.clientX-v.getBoundingClientRect().left,d=t.clientY-v.getBoundingClientRect().top,a=-1*t.deltaY/50,l=Math.exp(.05*a),r=Math.min(Math.max(o*l,.6),2);n({x:(i.x-s)*(r/o)+s,y:(i.y-d)*(r/o)+d}),function(t){e.scale=t}(r),M()})),document.addEventListener("dataChanged",(()=>{M()})),window.addEventListener("resize",I),I(),M(),t.drawNow=M,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
//# sourceMappingURL=builder.min.js.map
